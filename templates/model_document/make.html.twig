{% extends 'base.html.twig' %}

{% block title %}ModelDocument index{% endblock %}

{% block body %}
      <div class="d-flex">

            <a href="{{ path('model_document_index') }}" class="btn btn-outline-primary">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-return-left" fill="currentColor"
                     xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M5.854 5.646a.5.5 0 0 1 0 .708L3.207 9l2.647 2.646a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 0 1 .708 0z"></path>
                    <path fill-rule="evenodd"
                          d="M13.5 2.5a.5.5 0 0 1 .5.5v4a2.5 2.5 0 0 1-2.5 2.5H3a.5.5 0 0 1 0-1h8.5A1.5 1.5 0 0 0 13 7V3a.5.5 0 0 1 .5-.5z"></path>
                </svg>
            </a>
        </div>
    </div>

         <div class="row">
         <div class="col-lg-12">
            <div class="card">
                <div class="card-header"><i class="fa fa-table"></i>  Document </div>
                <div class="card-body">
        

        <label for="Model">Choix de model</label>
 {# //! Boucle et Choix de Models  #}
 <select name="models"  onchange="Choix_model(this)">
 <option value="-1">Sélectionner documents model</option>
 {% for doc in documents %} 
 <option value="{{doc.id}}">{{doc.intitule}} </option>
{% endfor %}
</select>
  
    
      {# ! Boucle pour les users #}
      <label for="Model">Choix de user</label>
 <select name="users" id="users" onChange="bind_user(this)" multiple >
 <option value="-1">Sélectionner User</option>
   {% for user in users %} 
 <option value="{{user.id}}">{{user.nomFr}} {{user.prenomFr}}</option>
{% endfor %}

</select>
  </tbody>
</table>
</div>
<div class="col">
           <div class="row m-2">
                      <button class=" btn btn-outline-primary" id="clear" >Clear</button>
           <div class="d-flex justify-content-center p-1">
                <a class=" btn btn-outline-primary" href="#"> nom & prenom</a>
            </div>
        <div class="d-flex justify-content-center p-1">
                <a class=" btn btn-outline-primary" href="#"> date </a>
            </div>
            <div class="d-flex justify-content-center p-1">
                <a class=" btn btn-outline-primary" href="#"> n° </a>
            </div>
            </div>
   <script src="//cdn.ckeditor.com/4.14.1/full/ckeditor.js"></script>
     
            <textarea name="editor1" id="editor1" rows="10" cols="80" required>
            </textarea>
            <script>
                CKEDITOR.replace( 'editor1' );
            </script>
        </form>
        </div>
        </div>
    

 </div>
     </div>
    </div>

{% endblock %}
{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script>
      
let users,models;                      
      // get all data on load

 
      axios({
    method:"get",
    url:"http://127.0.0.1:8000/model/document/getdataall"
}).then(function(res){
    models=res.data.models[0];
     users= res.data.models[1];
})
.catch(err=> console.log(err))
  
        function Choix_model(parms) {
            
            let id=parms.value;
              if(id==-1){
                 CKEDITOR.instances.editor1.setData('');
                 return;
              }
            
             for(let i =0;i<models.length;i++){
                   if(id==models[i].id){
                       CKEDITOR.instances.editor1.setData(models[i].content);         
                   }
             }
        }
    
     function bind_user(parms){
         let id=parms.value;
         if(id==-1)
         return;
let data = CKEDITOR.instances.editor1.getData();
     for(let i =0;i<users.length;i++){ 
        if(id==users[i].id){
            let name=users[i].nomFr+" "+users[i].prenomFr;
           
           data= data.replace("@{Nom&amp;prenom}",name); 
           data= data.replace("@{Date}",users[i].dateNaissance); 
           data= data.replace("@{num}",users[i].id);   
            console.log(data);
 } 
      
         
     }
      CKEDITOR.instances.editor1.setData(data);
     }
      </script>
      {% endblock %}